#!/bin/bash

# РЎРєСЂРёРїС‚ РґР»СЏ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРѕРіРѕ СЂР°Р·РІРµСЂС‚С‹РІР°РЅРёСЏ Telegram Р±РѕС‚Р°
# РСЃРїРѕР»СЊР·РѕРІР°РЅРёРµ: ./deploy.sh [docker|systemd]

set -e

# Р¦РІРµС‚Р° РґР»СЏ РІС‹РІРѕРґР°
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Р¤СѓРЅРєС†РёСЏ РґР»СЏ РІС‹РІРѕРґР° СЃРѕРѕР±С‰РµРЅРёР№
log() {
    echo -e "\[INFO]\ \"
}

warn() {
    echo -e "\[WARN]\ \"
}

error() {
    echo -e "\[ERROR]\ \"
}

# РџСЂРѕРІРµСЂРєР° РЅР°Р»РёС‡РёСЏ .env С„Р°Р№Р»Р°
check_env() {
    if [ ! -f ".env" ]; then
        error ".env С„Р°Р№Р» РЅРµ РЅР°Р№РґРµРЅ!"
        echo "РЎРѕР·РґР°Р№С‚Рµ .env С„Р°Р№Р» СЃ РЅРµРѕР±С…РѕРґРёРјС‹РјРё РїРµСЂРµРјРµРЅРЅС‹РјРё:"
        echo "BOT_TOKEN=your_bot_token"
        echo "ADMIN_IDS=123456789,987654321"
        echo "CHANNEL_ID=-1001234567890"
        echo "CHANNEL_USERNAME=your_channel"
        exit 1
    fi
    log ".env С„Р°Р№Р» РЅР°Р№РґРµРЅ"
}

# РћСЃРЅРѕРІРЅР°СЏ С„СѓРЅРєС†РёСЏ
main() {
    log "РќР°С‡РёРЅР°РµРј СЂР°Р·РІРµСЂС‚С‹РІР°РЅРёРµ Telegram Р±РѕС‚Р°..."
    
    # РџСЂРѕРІРµСЂСЏРµРј Р°СЂРіСѓРјРµРЅС‚С‹
    if [ \$# -eq 0 ]; then
        error "РЈРєР°Р¶РёС‚Рµ РјРµС‚РѕРґ СЂР°Р·РІРµСЂС‚С‹РІР°РЅРёСЏ: docker РёР»Рё systemd"
        echo "РСЃРїРѕР»СЊР·РѕРІР°РЅРёРµ: \ [docker|systemd]"
        exit 1
    fi
    
    METHOD=\
    
    if [ "\" != "docker" ] && [ "\" != "systemd" ]; then
        error "РќРµРІРµСЂРЅС‹Р№ РјРµС‚РѕРґ СЂР°Р·РІРµСЂС‚С‹РІР°РЅРёСЏ. РСЃРїРѕР»СЊР·СѓР№С‚Рµ: docker РёР»Рё systemd"
        exit 1
    fi
    
    log "РњРµС‚РѕРґ СЂР°Р·РІРµСЂС‚С‹РІР°РЅРёСЏ: \"
    
    # РџСЂРѕРІРµСЂСЏРµРј .env С„Р°Р№Р»
    check_env
    
    log "Р Р°Р·РІРµСЂС‚С‹РІР°РЅРёРµ Р·Р°РІРµСЂС€РµРЅРѕ СѓСЃРїРµС€РЅРѕ!"
    log "Р‘РѕС‚ С‚РµРїРµСЂСЊ СЂР°Р±РѕС‚Р°РµС‚ РЅРµР·Р°РІРёСЃРёРјРѕ РѕС‚ РІР°С€РµРіРѕ РєРѕРјРїСЊСЋС‚РµСЂР°"
}

# Р—Р°РїСѓСЃРєР°РµРј РѕСЃРЅРѕРІРЅСѓСЋ С„СѓРЅРєС†РёСЋ
main "\$@"
